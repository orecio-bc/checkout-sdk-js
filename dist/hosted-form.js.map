{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"tslib\"","webpack:///./src/cart/map-to-internal-cart.ts","webpack:///./src/promotion/map-to-discount-notifications.ts","webpack:///external \"@bigcommerce/bigpay-client\"","webpack:///./src/billing/is-billing-address-like.ts","webpack:///./src/hosted-form/iframe-content/card-expiry-formatter.ts","webpack:///./src/hosted-form/iframe-content/card-number-formatter.ts","webpack:///./src/coupon/map-to-internal-coupon.ts","webpack:///./src/common/error/errors/missing-data-error.ts","webpack:///./src/payment/payment-request-transformer.ts","webpack:///./src/payment/payment-request-sender.ts","webpack:///./src/coupon/map-to-internal-gift-certificate.ts","webpack:///./src/common/iframe/iframe-event-poster.ts","webpack:///./src/common/iframe/iframe-event-listener.ts","webpack:///./src/common/storage/browser-storage.ts","webpack:///./src/hosted-form/errors/invalid-hosted-form-config-error.ts","webpack:///./src/hosted-form/errors/invalid-hosted-form-value-error.ts","webpack:///./src/hosted-form/iframe-content/get-hosted-input-storage.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-storage.ts","webpack:///./src/hosted-form/hosted-field-type.ts","webpack:///./src/hosted-form/iframe-content/map-to-autocomplete-type.ts","webpack:///./src/hosted-form/iframe-content/hosted-autocomplete-fieldset.ts","webpack:///./src/hosted-form/iframe-content/hosted-input.ts","webpack:///./src/hosted-form/iframe-content/hosted-card-expiry-input.ts","webpack:///./src/hosted-form/iframe-content/hosted-card-number-input.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-aggregator.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-payment-handler.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-validator.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-factory.ts","webpack:///./src/hosted-form/iframe-content/map-to-accessibility-label.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-initializer.ts","webpack:///./src/hosted-form/iframe-content/initialize-hosted-input.ts","webpack:///./src/hosted-form/iframe-content/notify-initialize-error.ts","webpack:///./src/bundles/hosted-form.ts","webpack:///external \"lodash\"","webpack:///./src/common/error/errors/standard-error.ts","webpack:///./src/common/utility/set-prototype-of.ts","webpack:///external \"rxjs\"","webpack:///external \"card-validator\"","webpack:///./src/payment/is-vaulted-instrument.ts","webpack:///./src/hosted-form/iframe-content/hosted-input-events.ts","webpack:///external \"local-storage-fallback\"","webpack:///./src/common/error/errors/invalid-argument-error.ts","webpack:///./src/common/iframe/is-iframe-event.ts","webpack:///./src/payment/payment-method-types.ts","webpack:///./src/address/map-to-internal-address.ts","webpack:///./src/cart/map-to-internal-line-items.ts","webpack:///./src/cart/map-gift-certificate-to-internal-line-item.ts","webpack:///./src/hosted-form/hosted-field-events.ts","webpack:///./src/cart/map-to-internal-line-item.ts","webpack:///./src/shipping/map-to-internal-shipping-option.ts","webpack:///external \"rxjs/operators\"","webpack:///./src/common/utility/amount-transformer.ts","webpack:///./src/common/url/parse-url.ts","webpack:///external \"yup\"","webpack:///./src/common/utility/bind-decorator.ts","webpack:///./src/customer/map-to-internal-customer.ts","webpack:///./src/order/map-to-internal-order.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","mapToInternalCart","checkout","promotions","notifications","decimalPlaces","cart","currency","amountTransformer","id","items","lineItems","code","coupon","discountedAmount","coupons","sum","map","discount","amount","discountAmount","integerAmount","toInteger","discountNotifications","forEach","promotion","banners","banner","push","placeholders","discountType","message","messageHtml","text","giftCertificate","totalDiscountedAmount","giftCertificates","certificate","used","appliedGiftCertificates","shipping","shippingCostTotal","amountBeforeDiscount","shippingCostBeforeDiscount","integerAmountBeforeDiscount","required","physicalItems","lineItem","isShippingRequired","subtotal","storeCredit","customer","taxSubtotal","taxTotal","taxes","handling","handlingCostTotal","grandTotal","isBillingAddressLike","address","format","split","RegExp","month","year","trimmedMonth","slice","trimmedYear","length","toObject","test","card","maxLength","info","lengths","unformattedValue","this","unformat","gaps","filter","gapIndex","reduce","output","index","join","replace","couponTypes","mapToInternalCoupon","displayName","indexOf","couponType","MissingDataErrorType","subtype","type","MissingBillingAddress","MissingCart","MissingConsignments","MissingCheckout","MissingCheckoutConfig","MissingOrderConfig","MissingOrder","MissingOrderId","MissingPayment","MissingPaymentToken","MissingPaymentMethod","MissingShippingAddress","getErrorMessage","_cardExpiryFormatter","_cardNumberFormatter","transform","payment","checkoutState","billingAddress","getBillingAddress","getCheckout","getCustomer","order","getOrder","paymentMethod","paymentMethods","getPaymentMethod","methodId","gatewayId","shippingAddress","getShippingAddress","consignments","getConsignments","shippingOption","getShippingOption","storeConfig","config","getStoreConfig","contextConfig","getContextConfig","instrumentMeta","instruments","getInstrumentsMeta","paymentMeta","getPaymentMethodsMeta","orderMeta","getOrderMeta","internalCustomer","authToken","paymentData","getPaymentToken","vaultAccessToken","additionalAction","_transformPaymentMethod","quoteMeta","request","geoCountryCode","source","store","storeProfile","transformWithHostedFormData","values","data","nonce","paymentMethodMeta","consignment","selectedShippingOption","_transformHostedInputValues","context","method","gateway","initializationData","ccCvv","cardCodeVerification","ccNumber","cardNumberVerification","hostedFormNonce","cardCode","ccExpiry","cardExpiry","ccName","cardName","cardNumber","_client","submitPayment","payload","Promise","resolve","reject","error","response","_transformResponse","initializeOffsitePayment","target","headers","body","status","statusText","mapToInternalGiftCertificate","remainingBalance","remaining","balance","purchaseDate","targetOrigin","_targetWindow","_targetOrigin","origin","post","event","options","window","Error","result","pipe","successType","errorType","toPromise","postMessage","setTarget","sourceOrigin","_sourceOrigin","_isListening","_listeners","listen","addEventListener","_handleMessage","stopListen","removeEventListener","addListener","listener","listeners","removeListener","splice","trigger","_namespace","getItem","rawValue","withNamespace","JSON","parse","removeItem","getItemOnce","setItem","stringify","errors","fieldErrors","storage","_storage","setNonce","getNonce","STORAGE_NAMESPACE","getHostedInputStorage","HostedFieldType","mapToAutocompleteType","CardCode","CardExpiry","CardName","CardNumber","_form","_fieldTypes","_inputAggregator","_handleChange","targetInput","targetHostedInput","getInputs","find","input","_getAutocompleteElementId","getType","setValue","_inputs","_createInput","attach","appendChild","detach","parentElement","removeChild","document","createElement","autocomplete","tabIndex","style","position","opacity","zIndex","_type","_placeholder","_accessibilityLabel","_autocomplete","_styles","_fontUrls","_eventListener","_eventPoster","_inputValidator","_paymentHandler","_isTouched","_handleInput","_processChange","_handleBlur","_applyStyles","default","_validateForm","Blurred","fieldType","_handleFocus","focus","Focused","_handleValidate","_handleSubmit","preventDefault","Entered","_input","ValidateRequested","SubmitRequested","handle","_configureInput","getValue","isTouched","_loadFonts","parent","hostedInput","AttachSucceeded","_unloadFonts","_formatValue","_notifyChange","_value","Changed","backgroundColor","border","display","height","margin","outline","padding","width","placeholder","setAttribute","styles","allowedStyles","color","fontFamily","fontSize","fontWeight","keys","_fontLinks","url","hostname","querySelector","link","rel","href","head","undefined","getInputValues","validate","results","isValid","Validated","_previousValue","form","accessibilityLabel","fontUrls","eventListener","eventPoster","inputAggregator","inputValidator","paymentHandler","_formatter","_autocompleteFieldset","cardInfo","prevCardInfo","CardTypeChanged","cardType","unformattedPreviousValue","bin","isPotentiallyValid","substr","BinChanged","selectionEnd","formattedValue","setSelectionRange","_parentWindow","Array","frames","frame","DOMException","_inputStorage","_paymentRequestSender","_paymentRequestTransformer","SubmitFailed","SubmitSucceeded","_isPaymentErrorResponse","_cardInstrument","_configureCardValidator","requiredFields","schemas","_getCardCodeSchema","CardCodeVerification","_getCardCodeVerificationSchema","_getCardExpirySchema","_getCardNameSchema","_getCardNumberSchema","CardNumberVerification","_getCardNumberVerificationSchema","abortEarly","inner","innerError","path","discoverInfo","getTypeInfo","visaInfo","updateCard","patterns","addCard","niceType","size","_mapFromInstrumentCardType","brand","max","last4","_parentOrigin","cardInstrument","mapToAccessibilityLabel","_createNumberInput","_createExpiryInput","_createPaymentHandler","_factory","initialize","containerId","_createFormContainer","_resetPageStyles","AttachRequested","field","getElementById","node","overflow","container","button","noValidate","initializeHostedInput","parentOrigin","poster","notifyInitializeError","AttachFailed","setPrototypeOf","__proto__","captureStackTrace","stack","isVaultedInstrument","instrument","Boolean","instrumentId","isHostedVaultedInstrument","isFormattedVaultedInstrument","formattedInstrument","formattedPayload","bigpay_token","token","HostedInputEventType","isIframeEvent","HOSTED","OFFLINE","mapToInternalAddress","addressId","firstName","lastName","company","addressLine1","address1","addressLine2","address2","city","province","stateOrProvince","provinceCode","stateOrProvinceCode","postCode","postalCode","country","countryCode","phone","customFields","mapToInternalLineItems","itemMap","idKey","item","imageUrl","amountAfterDiscount","integerAmountAfterDiscount","integerUnitPrice","integerUnitPriceAfterDiscount","integerDiscount","quantity","sender","recipient","attributes","variantId","mapGiftCertificateToInternalLineItem","mapToInternalLineItemType","HostedFieldEventType","mapToInternalLineItem","extendedListPrice","extendedSalePrice","listPrice","salePrice","downloadsPageUrl","downloadPageUrl","sku","categoryNames","productId","option","addedByPromotion","mapToInternalShippingOption","isSelected","description","price","cost","selected","isRecommended","transitTime","_decimalPlaces","Math","round","pow","parseUrl","anchor","port","hash","protocol","pathname","search","bindMethodDecorator","_","descriptor","boundMethod","set","decoratedTarget","getOwnPropertyNames","getOwnPropertyDescriptor","bindClassDecorator","mapToInternalCustomer","addresses","customerId","isGuest","email","fullName","customerGroupName","customerGroup","mapToInternalOrder","payments","orderId","customerCanBeCreated","mapToInternalOrderPayment","baseAmount","orderToken","callbackUrl","providerId","detail","socialData","mapToInternalSocialDataList","hasDigitalItems","isDownloadable","isComplete","mapToStoreCredit","orderAmount","orderAmountAsInteger","mapToInternalPaymentStatus","isDefaultOrderPayment","step","helpText","instructions","returnUrl","socialDataObject","digitalItems","socialMedia","image","shareText","sharingLink","channelName","channel","channelCode"],"mappings":"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","file":"hosted-form.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 195);\n","module.exports = require(\"tslib\");","import { keyBy, reduce, some } from 'lodash';\n\nimport { Checkout } from '../checkout';\nimport { AmountTransformer } from '../common/utility';\nimport { mapToInternalCoupon, mapToInternalGiftCertificate } from '../coupon';\nimport { mapToDiscountNotifications } from '../promotion';\n\nimport InternalCart from './internal-cart';\nimport mapToInternalLineItems from './map-to-internal-line-items';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalCart(checkout: Checkout): InternalCart {\n    const decimalPlaces = checkout.cart.currency.decimalPlaces;\n    const amountTransformer = new AmountTransformer(decimalPlaces);\n\n    return {\n        id: checkout.cart.id,\n        items: mapToInternalLineItems(checkout.cart.lineItems, decimalPlaces),\n        currency: checkout.cart.currency.code,\n        coupon: {\n            discountedAmount: reduce(checkout.cart.coupons, (sum, coupon) => {\n                return sum + coupon.discountedAmount;\n            }, 0),\n            coupons: checkout.cart.coupons.map(mapToInternalCoupon),\n        },\n        discount: {\n            amount: checkout.cart.discountAmount,\n            integerAmount: amountTransformer.toInteger(checkout.cart.discountAmount),\n        },\n        discountNotifications: mapToDiscountNotifications(checkout.promotions),\n        giftCertificate: {\n            totalDiscountedAmount: reduce(checkout.giftCertificates, (sum, certificate) => {\n                return sum + certificate.used;\n            }, 0),\n            appliedGiftCertificates: keyBy(checkout.giftCertificates.map(mapToInternalGiftCertificate), 'code'),\n        },\n        shipping: {\n            amount: checkout.shippingCostTotal,\n            integerAmount: amountTransformer.toInteger(checkout.shippingCostTotal),\n            amountBeforeDiscount: checkout.shippingCostBeforeDiscount,\n            integerAmountBeforeDiscount: amountTransformer.toInteger(checkout.shippingCostBeforeDiscount),\n            required: some(checkout.cart.lineItems.physicalItems, lineItem => lineItem.isShippingRequired),\n        },\n        subtotal: {\n            amount: checkout.subtotal,\n            integerAmount: amountTransformer.toInteger(checkout.subtotal),\n        },\n        storeCredit: {\n            amount: checkout.customer ? checkout.customer.storeCredit : 0,\n        },\n        taxSubtotal: {\n            amount: checkout.taxTotal,\n            integerAmount: amountTransformer.toInteger(checkout.taxTotal),\n        },\n        taxes: checkout.taxes,\n        taxTotal: {\n            amount: checkout.taxTotal,\n            integerAmount: amountTransformer.toInteger(checkout.taxTotal),\n        },\n        handling: {\n            amount: checkout.handlingCostTotal,\n            integerAmount: amountTransformer.toInteger(checkout.handlingCostTotal),\n        },\n        grandTotal: {\n            amount: checkout.grandTotal,\n            integerAmount: amountTransformer.toInteger(checkout.grandTotal),\n        },\n    };\n}\n","import { DiscountNotification } from '../discount';\n\nimport { Promotion } from '.';\n\nexport default function mapToDiscountNotifications(promotions?: Promotion[]): DiscountNotification[] {\n    const notifications: DiscountNotification[] = [];\n\n    (promotions || []).forEach(promotion => {\n        (promotion.banners || []).forEach(banner => {\n            notifications.push({\n                placeholders: [],\n                discountType: null,\n                message: '',\n                messageHtml: banner.text,\n            });\n        });\n    });\n\n    return notifications;\n}\n","module.exports = require(\"@bigcommerce/bigpay-client\");","import { Address } from '../address';\n\nimport BillingAddress from './billing-address';\n\nexport default function isBillingAddressLike(address: Address): address is BillingAddress {\n    const billingAddress = address as BillingAddress;\n\n    return typeof billingAddress.id !== 'undefined';\n}\n","import CardExpiryDate from './card-expiry-date';\n\nconst NUMBER_SEPARATOR = '/';\n\nexport default class CardExpiryFormatter {\n    format(value: string): string {\n        const [month = '', year = ''] = value.split(new RegExp(`\\\\s*${NUMBER_SEPARATOR}\\\\s*`));\n        const trimmedMonth = month.slice(0, 2);\n        const trimmedYear = year.length === 4 ? year.slice(-2) : (year ? year.slice(0, 2) : month.slice(2));\n\n        // i.e.: '1'\n        if (value.length < 2) {\n            return month;\n        }\n\n        // ie.: '10 /' (without trailing space)\n        if (value.length > 3 && !trimmedYear) {\n            return trimmedMonth;\n        }\n\n        return `${trimmedMonth} ${NUMBER_SEPARATOR} ${trimmedYear}`;\n    }\n\n    toObject(value: string): CardExpiryDate {\n        const [month = '', year = ''] = value.split(new RegExp(`\\\\s*${NUMBER_SEPARATOR}\\\\s*`));\n\n        if (!/^\\d+$/.test(month) || !/^\\d+$/.test(year)) {\n            return { month: '', year: '' };\n        }\n\n        return {\n            month: month.length === 1 ? `0${month}` : month.slice(0, 2),\n            year: year.length === 2 ? `20${year}` : year.slice(0, 4),\n        };\n    }\n}\n","import { creditCardType, number } from 'card-validator';\nimport { max } from 'lodash';\n\nconst NUMBER_SEPARATOR = ' ';\n\nexport default class CardNumberFormatter {\n    format(value: string): string {\n        const { card } = number(value);\n\n        if (!card) {\n            return value;\n        }\n\n        const maxLength = max(creditCardType(value).map(info => max(info.lengths)));\n        const unformattedValue = this.unformat(value).slice(0, maxLength);\n\n        return card.gaps\n            .filter(gapIndex => unformattedValue.length > gapIndex)\n            .reduce((output, gapIndex, index) => (\n                [\n                    output.slice(0, gapIndex + index),\n                    output.slice(gapIndex + index),\n                ].join(NUMBER_SEPARATOR)\n            ), unformattedValue);\n    }\n\n    unformat(value: string): string {\n        const { card } = number(value);\n\n        if (!card) {\n            return value;\n        }\n\n        return value.replace(new RegExp(NUMBER_SEPARATOR, 'g'), '');\n    }\n}\n","import Coupon from './coupon';\nimport InternalCoupon from './internal-coupon';\n\nconst couponTypes = [\n    'per_item_discount',\n    'percentage_discount',\n    'per_total_discount',\n    'shipping_discount',\n    'free_shipping',\n];\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalCoupon(coupon: Coupon): InternalCoupon {\n    return {\n        code: coupon.code,\n        discount: coupon.displayName,\n        discountType: couponTypes.indexOf(coupon.couponType),\n    };\n}\n","import StandardError from './standard-error';\n\nexport enum MissingDataErrorType {\n    MissingBillingAddress,\n    MissingCart,\n    MissingCheckout,\n    MissingConsignments,\n    MissingCheckoutConfig,\n    MissingOrder,\n    MissingOrderConfig,\n    MissingOrderId,\n    MissingPayment,\n    MissingPaymentInstrument,\n    MissingPaymentMethod,\n    MissingPaymentToken,\n    MissingShippingAddress,\n}\n\n/**\n * Throw this error when data that is expected to exist is missing. Usually it\n * is due to the fact that certain data has not been retrieved from or saved to\n * the server yet. And such data is required to perform certain actions.\n */\nexport default class MissingDataError extends StandardError {\n    constructor(\n        public subtype: MissingDataErrorType\n    ) {\n        super(getErrorMessage(subtype));\n\n        this.name = 'MissingDataError';\n        this.type = 'missing_data';\n    }\n}\n\nfunction getErrorMessage(type: MissingDataErrorType): string {\n    switch (type) {\n    case MissingDataErrorType.MissingBillingAddress:\n        return 'Unable to proceed because billing address data is unavailable.';\n\n    case MissingDataErrorType.MissingCart:\n        return 'Unable to proceed because cart data is unavailable.';\n\n    case MissingDataErrorType.MissingConsignments:\n        return 'Unable to proceed because consignments data is unavailable.';\n\n    case MissingDataErrorType.MissingCheckout:\n        return 'Unable to proceed because checkout data is unavailable.';\n\n    case MissingDataErrorType.MissingCheckoutConfig:\n    case MissingDataErrorType.MissingOrderConfig:\n        return 'Unable to proceed because configuration data is unavailable.';\n\n    case MissingDataErrorType.MissingOrder:\n        return 'Unable to proceed because order data is unavailable.';\n\n    case MissingDataErrorType.MissingOrderId:\n        return 'Unable to proceed because order ID is unavailable or not generated yet.';\n\n    case MissingDataErrorType.MissingPayment:\n        return 'Unable to proceed because payment data is unavailable.';\n\n    case MissingDataErrorType.MissingPaymentToken:\n        return 'Unable to proceed because the token required to submit a payment is missing.';\n\n    case MissingDataErrorType.MissingPaymentMethod:\n        return 'Unable to proceed because payment method data is unavailable or not properly configured.';\n\n    case MissingDataErrorType.MissingShippingAddress:\n        return 'Unable to proceed because shipping address data is unavailable.';\n\n    default:\n        return 'Unable to proceed because the required data is unavailable.';\n    }\n}\n","import { pick } from 'lodash';\n\nimport { mapToInternalAddress } from '../address';\nimport { mapToInternalCart } from '../cart';\nimport { InternalCheckoutSelectors } from '../checkout';\nimport { MissingDataError, MissingDataErrorType } from '../common/error/errors';\nimport { mapToInternalCustomer } from '../customer';\nimport { HostedFormOrderData } from '../hosted-form';\nimport { CardExpiryFormatter, CardNumberFormatter, HostedInputValues } from '../hosted-form/iframe-content';\nimport { mapToInternalOrder } from '../order';\nimport { mapToInternalShippingOption } from '../shipping';\n\nimport isVaultedInstrument, { isFormattedVaultedInstrument } from './is-vaulted-instrument';\nimport Payment, { HostedCreditCardInstrument, HostedVaultedInstrument, PaymentInstrument } from './payment';\nimport PaymentMethod from './payment-method';\nimport PaymentRequestBody from './payment-request-body';\n\nexport default class PaymentRequestTransformer {\n    private _cardExpiryFormatter = new CardExpiryFormatter();\n    private _cardNumberFormatter = new CardNumberFormatter();\n\n    transform(payment: Payment, checkoutState: InternalCheckoutSelectors): PaymentRequestBody {\n        const billingAddress = checkoutState.billingAddress.getBillingAddress();\n        const checkout = checkoutState.checkout.getCheckout();\n        const customer = checkoutState.customer.getCustomer();\n        const order = checkoutState.order.getOrder();\n        const paymentMethod = checkoutState.paymentMethods.getPaymentMethod(payment.methodId, payment.gatewayId);\n        const shippingAddress = checkoutState.shippingAddress.getShippingAddress();\n        const consignments = checkoutState.consignments.getConsignments();\n        const shippingOption = checkoutState.consignments.getShippingOption();\n        const storeConfig = checkoutState.config.getStoreConfig();\n        const contextConfig = checkoutState.config.getContextConfig();\n        const instrumentMeta = checkoutState.instruments.getInstrumentsMeta();\n        const paymentMeta = checkoutState.paymentMethods.getPaymentMethodsMeta();\n        const orderMeta = checkoutState.order.getOrderMeta();\n        const internalCustomer = customer && billingAddress && mapToInternalCustomer(customer, billingAddress);\n\n        const authToken = instrumentMeta && payment.paymentData &&\n            (isVaultedInstrument(payment.paymentData) || isFormattedVaultedInstrument(payment.paymentData)) ?\n            `${checkoutState.payment.getPaymentToken()}, ${instrumentMeta.vaultAccessToken}` :\n            checkoutState.payment.getPaymentToken();\n\n        if (!authToken) {\n            throw new MissingDataError(MissingDataErrorType.MissingPaymentToken);\n        }\n\n        return {\n            additionalAction: payment.additionalAction,\n            authToken,\n            customer: internalCustomer,\n            billingAddress: billingAddress && mapToInternalAddress(billingAddress),\n            shippingAddress: shippingAddress && mapToInternalAddress(shippingAddress, consignments),\n            shippingOption: shippingOption && mapToInternalShippingOption(shippingOption, true),\n            cart: checkout && mapToInternalCart(checkout),\n            order: order && mapToInternalOrder(order, orderMeta),\n            orderMeta,\n            payment: payment.paymentData,\n            paymentMethod: paymentMethod && this._transformPaymentMethod(paymentMethod),\n            quoteMeta: {\n                request: {\n                    ...paymentMeta,\n                    geoCountryCode: contextConfig && contextConfig.geoCountryCode,\n                },\n            },\n            source: 'bigcommerce-checkout-js-sdk',\n            store: pick(storeConfig && storeConfig.storeProfile, [\n                'storeHash',\n                'storeId',\n                'storeLanguage',\n                'storeName',\n            ]),\n        };\n    }\n\n    transformWithHostedFormData(values: HostedInputValues, data: HostedFormOrderData, nonce: string): PaymentRequestBody {\n        const { additionalAction, authToken, checkout, config, order, orderMeta, payment = {}, paymentMethod, paymentMethodMeta } = data;\n        const consignment = checkout && checkout.consignments[0];\n        const shippingAddress = consignment && consignment.shippingAddress;\n        const shippingOption = consignment && consignment.selectedShippingOption;\n\n        return {\n            additionalAction,\n            authToken,\n            paymentMethod: paymentMethod && this._transformPaymentMethod(paymentMethod),\n            customer: order && order.billingAddress && checkout && mapToInternalCustomer(checkout.customer, order.billingAddress),\n            billingAddress: order && order.billingAddress && mapToInternalAddress(order.billingAddress),\n            shippingAddress: shippingAddress && checkout && mapToInternalAddress(shippingAddress, checkout.consignments),\n            shippingOption: shippingOption && mapToInternalShippingOption(shippingOption, true),\n            cart: checkout && mapToInternalCart(checkout),\n            order: order && mapToInternalOrder(order, orderMeta),\n            orderMeta,\n            payment: this._transformHostedInputValues(values, payment, nonce),\n            quoteMeta: {\n                request: {\n                    ...paymentMethodMeta,\n                    geoCountryCode: config && config.context.geoCountryCode,\n                },\n            },\n            source: 'bigcommerce-checkout-js-sdk',\n            store: config && pick(config.storeConfig.storeProfile, [\n                'storeHash',\n                'storeId',\n                'storeLanguage',\n                'storeName',\n            ]),\n        };\n    }\n\n    private _transformPaymentMethod(paymentMethod: PaymentMethod): PaymentMethod {\n        if (paymentMethod.method === 'multi-option' && !paymentMethod.gateway) {\n            return { ...paymentMethod, gateway: paymentMethod.id };\n        }\n\n        if (paymentMethod.initializationData && paymentMethod.initializationData.gateway) {\n            return { ...paymentMethod, id: paymentMethod.initializationData.gateway };\n        }\n\n        return paymentMethod;\n    }\n\n    private _transformHostedInputValues(\n        values: HostedInputValues,\n        payment: HostedCreditCardInstrument | HostedVaultedInstrument,\n        nonce: string\n    ): PaymentInstrument {\n        return 'instrumentId' in payment ?\n            {\n                ...payment,\n                ccCvv: values.cardCodeVerification,\n                ccNumber: values.cardNumberVerification && this._cardNumberFormatter.unformat(values.cardNumberVerification),\n                hostedFormNonce: nonce,\n            } :\n            {\n                ...payment,\n                ccCvv: values.cardCode,\n                ccExpiry: this._cardExpiryFormatter.toObject(values.cardExpiry || ''),\n                ccName: values.cardName || '',\n                ccNumber: this._cardNumberFormatter.unformat(values.cardNumber || ''),\n                hostedFormNonce: nonce,\n            };\n    }\n}\n","import { Response } from '@bigcommerce/request-sender';\n\nimport PaymentRequestBody from './payment-request-body';\n\n/**\n * @todo Convert this file into TypeScript properly\n */\nexport default class PaymentRequestSender {\n    /**\n     * @constructor\n     * @param {BigpayClient} client\n     */\n    constructor(\n        private _client: any\n    ) {}\n\n    submitPayment(payload: PaymentRequestBody): Promise<Response<any>> {\n        return new Promise((resolve, reject) => {\n            this._client.submitPayment(payload, (error: any, response: any) => {\n                if (error) {\n                    reject(this._transformResponse(error));\n                } else {\n                    resolve(this._transformResponse(response));\n                }\n            });\n        });\n    }\n\n    initializeOffsitePayment(payload: PaymentRequestBody, target?: string): Promise<void> {\n        return new Promise(() => {\n            this._client.initializeOffsitePayment(payload, null, target);\n        });\n    }\n\n    private _transformResponse(response: any): Response<any> {\n        return {\n            headers: response.headers,\n            body: response.data,\n            status: response.status,\n            statusText: response.statusText,\n        };\n    }\n}\n","import GiftCertificate from './gift-certificate';\nimport InternalGiftCertificate from './internal-gift-certificate';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalGiftCertificate(giftCertificate: GiftCertificate): InternalGiftCertificate {\n    return {\n        code: giftCertificate.code,\n        discountedAmount: giftCertificate.used,\n        remainingBalance: giftCertificate.remaining,\n        giftCertificate: {\n            balance: giftCertificate.balance,\n            code: giftCertificate.code,\n            purchaseDate: giftCertificate.purchaseDate,\n        },\n    };\n}\n","import { fromEvent } from 'rxjs';\nimport { filter, map, take } from 'rxjs/operators';\n\nimport { parseUrl } from '../url';\n\nimport IframeEvent from './iframe-event';\nimport isIframeEvent from './is-iframe-event';\n\nexport interface IframeEventPostOptions<TSuccessEvent extends IframeEvent, TErrorEvent extends IframeEvent> {\n    errorType?: TErrorEvent['type'];\n    successType?: TSuccessEvent['type'];\n}\n\nexport default class IframeEventPoster<TEvent> {\n    private _targetOrigin: string;\n\n    constructor(\n        targetOrigin: string,\n        private _targetWindow?: Window\n    ) {\n        this._targetOrigin = targetOrigin === '*' ? '*' : parseUrl(targetOrigin).origin;\n    }\n\n    post(event: TEvent): void;\n    post<TSuccessEvent extends IframeEvent = IframeEvent, TErrorEvent extends IframeEvent = IframeEvent>(\n        event: TEvent,\n        options: IframeEventPostOptions<TSuccessEvent, TErrorEvent>\n    ): Promise<TSuccessEvent>;\n    post<TSuccessEvent extends IframeEvent = IframeEvent, TErrorEvent extends IframeEvent = IframeEvent>(\n        event: TEvent,\n        options?: IframeEventPostOptions<TSuccessEvent, TErrorEvent>\n    ): Promise<TSuccessEvent> | void {\n        if (window === this._targetWindow) {\n            return;\n        }\n\n        if (!this._targetWindow) {\n            throw new Error('Unable to post message because target window is not set.');\n        }\n\n        const result = options && fromEvent<MessageEvent>(window, 'message')\n            .pipe(\n                filter(event =>\n                    event.origin === this._targetOrigin &&\n                    isIframeEvent(event.data, event.data.type) &&\n                    [options.successType, options.errorType].indexOf(event.data.type) !== -1\n                ),\n                map(event => {\n                    if (options.errorType === event.data.type) {\n                        throw event.data;\n                    }\n\n                    return event.data;\n                }),\n                take(1)\n            )\n            .toPromise();\n\n        this._targetWindow.postMessage(event, this._targetOrigin);\n\n        return result;\n    }\n\n    setTarget(window: Window) {\n        this._targetWindow = window;\n    }\n}\n","import { parseUrl } from '../url';\nimport { bindDecorator as bind } from '../utility';\n\nimport { IframeEventMap } from './iframe-event';\nimport isIframeEvent from './is-iframe-event';\n\nexport default class IframeEventListener<TEventMap extends IframeEventMap<keyof TEventMap>> {\n    private _isListening: boolean;\n    private _listeners: EventListeners<TEventMap>;\n    private _sourceOrigin: string;\n\n    constructor(\n        sourceOrigin: string\n    ) {\n        this._sourceOrigin = parseUrl(sourceOrigin).origin;\n        this._isListening = false;\n        this._listeners = {};\n    }\n\n    listen(): void {\n        if (this._isListening) {\n            return;\n        }\n\n        this._isListening = true;\n\n        window.addEventListener('message', this._handleMessage);\n    }\n\n    stopListen(): void {\n        if (!this._isListening) {\n            return;\n        }\n\n        this._isListening = false;\n\n        window.removeEventListener('message', this._handleMessage);\n    }\n\n    addListener<TType extends keyof TEventMap>(type: TType, listener: (event: TEventMap[TType]) => void): void {\n        let listeners = this._listeners[type];\n\n        if (!listeners) {\n            this._listeners[type] = listeners = [];\n        }\n\n        if (listeners.indexOf(listener) === -1) {\n            listeners.push(listener);\n        }\n    }\n\n    removeListener<TType extends keyof TEventMap>(type: TType, listener: (event: TEventMap[TType]) => void): void {\n        const listeners = this._listeners[type];\n\n        if (!listeners) {\n            return;\n        }\n\n        const index = listeners.indexOf(listener);\n\n        if (index >= 0) {\n            listeners.splice(index, 1);\n        }\n    }\n\n    trigger<TType extends keyof TEventMap>(event: TEventMap[TType]): void {\n        const listeners = this._listeners[event.type];\n\n        if (!listeners) {\n            return;\n        }\n\n        listeners.forEach(listener => listener(event));\n    }\n\n    @bind\n    private _handleMessage(event: MessageEvent): void {\n        if ((event.origin !== this._sourceOrigin) ||\n            !isIframeEvent(event.data as TEventMap[keyof TEventMap], event.data.type)\n        ) {\n            return;\n        }\n\n        this.trigger(event.data);\n    }\n}\n\ntype EventListeners<TEventMap> = {\n    [key in keyof TEventMap]?: Array<(event: TEventMap[key]) => void>;\n};\n","import { default as storage } from 'local-storage-fallback';\n\nexport default class BrowserStorage {\n    constructor(\n        private _namespace: string\n    ) {}\n\n    getItem<TValue = any>(key: string): TValue | null {\n        const rawValue = storage.getItem(this.withNamespace(key));\n\n        if (rawValue === null) {\n            return null;\n        }\n\n        try {\n            return JSON.parse(rawValue);\n        } catch (error) {\n            // Clean up invalid values\n            this.removeItem(this.withNamespace(key));\n\n            return null;\n        }\n    }\n\n    getItemOnce<TValue = any>(key: string): TValue | null {\n        const value = this.getItem(key);\n\n        this.removeItem(key);\n\n        return value;\n    }\n\n    setItem<TValue = any>(key: string, value: TValue): void {\n        return storage.setItem(this.withNamespace(key), JSON.stringify(value));\n    }\n\n    removeItem(key: string): void {\n        return storage.removeItem(this.withNamespace(key));\n    }\n\n    private withNamespace(key: string): string {\n        return `${this._namespace}.${key}`;\n    }\n}\n","import { StandardError } from '../../common/error/errors';\n\nexport default class InvalidHostedFormConfigError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Unable to proceed due to invalid configuration provided for the hosted payment form.');\n\n        this.name = 'InvalidHostedFormConfigError';\n        this.type = 'invalid_hosted_form_config';\n    }\n}\n","import { flatMap, map, values } from 'lodash';\n\nimport { StandardError } from '../../common/error/errors';\nimport { HostedInputValidateErrorDataMap } from '../iframe-content';\n\nexport default class InvalidHostedFormValueError extends StandardError {\n    constructor(\n        public errors: HostedInputValidateErrorDataMap\n    ) {\n        super([\n            'Unable to proceed due to invalid user input values',\n            ...flatMap(values(errors), fieldErrors => map(fieldErrors, ({ message }) => message)),\n        ].join('. '));\n\n        this.name = 'InvalidHostedFormValueError';\n        this.type = 'invalid_hosted_form_value';\n    }\n}\n","import { BrowserStorage } from '../../common/storage';\n\nimport HostedInputStorage from './hosted-input-storage';\n\nconst STORAGE_NAMESPACE = 'BigCommerce.HostedInput';\n\nlet storage: HostedInputStorage | null;\n\nexport default function getHostedInputStorage(): HostedInputStorage {\n    storage = storage || new HostedInputStorage(\n        new BrowserStorage(STORAGE_NAMESPACE)\n    );\n\n    return storage;\n}\n","import { BrowserStorage } from '../../common/storage';\n\nexport default class HostedInputStorage {\n    constructor(\n        private _storage: BrowserStorage\n    ) {}\n\n    setNonce(nonce: string): void {\n        this._storage.setItem('nonce', nonce);\n    }\n\n    getNonce(): string | null {\n        return this._storage.getItem('nonce');\n    }\n}\n","enum HostedFieldType {\n    CardCode = 'cardCode',\n    CardCodeVerification = 'cardCodeVerification',\n    CardExpiry = 'cardExpiry',\n    CardName = 'cardName',\n    CardNumber = 'cardNumber',\n    CardNumberVerification = 'cardNumberVerification',\n}\n\nexport default HostedFieldType;\n","import HostedFieldType from '../hosted-field-type';\n\nexport default function mapToAutocompleteType(type: HostedFieldType): string {\n    switch (type) {\n    case HostedFieldType.CardCode:\n        return 'cc-csc';\n\n    case HostedFieldType.CardExpiry:\n        return 'cc-exp';\n\n    case HostedFieldType.CardName:\n        return 'cc-name';\n\n    case HostedFieldType.CardNumber:\n        return 'cc-number';\n\n    default:\n        return '';\n    }\n}\n","import { kebabCase } from 'lodash';\n\nimport HostedFieldType from '../hosted-field-type';\n\nimport HostedInputAggregator from './hosted-input-aggregator';\nimport mapToAutocompleteType from './map-to-autocomplete-type';\n\nexport default class HostedAutocompleteFieldset {\n    private _inputs: HTMLInputElement[];\n\n    constructor(\n        private _form: HTMLFormElement,\n        private _fieldTypes: HostedFieldType[],\n        private _inputAggregator: HostedInputAggregator\n    ) {\n        this._inputs = this._fieldTypes.map(type => this._createInput(type));\n    }\n\n    attach(): void {\n        this._inputs.forEach(input => this._form.appendChild(input));\n    }\n\n    detach(): void {\n        this._inputs.forEach(input => {\n            if (!input.parentElement) {\n                return;\n            }\n\n            input.parentElement.removeChild(input);\n        });\n    }\n\n    private _createInput(type: HostedFieldType): HTMLInputElement {\n        const input = document.createElement('input');\n\n        input.autocomplete = mapToAutocompleteType(type);\n        input.id = this._getAutocompleteElementId(type);\n        input.tabIndex = -1;\n        input.style.position = 'absolute';\n        input.style.opacity = '0';\n        input.style.zIndex = '-1';\n\n        input.addEventListener('change', this._handleChange);\n\n        return input;\n    }\n\n    private _handleChange: (event: Event) => void = event => {\n        const targetInput = event.target as HTMLInputElement;\n\n        if (!targetInput) {\n            throw new Error('Unable to get a reference to the target of the change event.');\n        }\n\n        const targetHostedInput = this._inputAggregator.getInputs()\n            .find(input => this._getAutocompleteElementId(input.getType()) === targetInput.id);\n\n        if (!targetHostedInput) {\n            return;\n        }\n\n        targetHostedInput.setValue(targetInput.value);\n    };\n\n    private _getAutocompleteElementId(type: HostedFieldType): string {\n        return `autocomplete-${kebabCase(type)}`;\n    }\n}\n","import { kebabCase } from 'lodash';\n\nimport { IframeEventListener, IframeEventPoster } from '../../common/iframe';\nimport { parseUrl } from '../../common/url';\nimport { HostedFieldEventMap, HostedFieldEventType, HostedFieldValidateRequestEvent } from '../hosted-field-events';\nimport HostedFieldType from '../hosted-field-type';\n\nimport HostedInputAggregator from './hosted-input-aggregator';\nimport { HostedInputEvent, HostedInputEventType } from './hosted-input-events';\nimport HostedInputPaymentHandler from './hosted-input-payment-handler';\nimport HostedInputStyles, { HostedInputStylesMap } from './hosted-input-styles';\nimport HostedInputValidator from './hosted-input-validator';\nimport HostedInputWindow from './hosted-input-window';\n\nexport default class HostedInput {\n    protected _input: HTMLInputElement;\n    protected _previousValue?: string;\n    private _fontLinks?: HTMLLinkElement[];\n    private _isTouched: boolean = false;\n\n    /**\n     * @internal\n     */\n    constructor(\n        protected _type: HostedFieldType,\n        protected _form: HTMLFormElement,\n        protected _placeholder: string,\n        protected _accessibilityLabel: string,\n        protected _autocomplete: string,\n        protected _styles: HostedInputStylesMap,\n        protected _fontUrls: string[],\n        protected _eventListener: IframeEventListener<HostedFieldEventMap>,\n        protected _eventPoster: IframeEventPoster<HostedInputEvent>,\n        protected _inputAggregator: HostedInputAggregator,\n        protected _inputValidator: HostedInputValidator,\n        protected _paymentHandler: HostedInputPaymentHandler\n    ) {\n        this._input = document.createElement('input');\n\n        this._input.addEventListener('input', this._handleInput);\n        this._input.addEventListener('blur', this._handleBlur);\n        this._input.addEventListener('focus', this._handleFocus);\n        this._eventListener.addListener(HostedFieldEventType.ValidateRequested, this._handleValidate);\n        this._eventListener.addListener(HostedFieldEventType.SubmitRequested, this._paymentHandler.handle);\n\n        this._configureInput();\n    }\n\n    getType(): HostedFieldType {\n        return this._type;\n    }\n\n    getValue(): string {\n        return this._input.value;\n    }\n\n    setValue(value: string): void {\n        this._processChange(value);\n    }\n\n    isTouched(): boolean {\n        return this._isTouched;\n    }\n\n    attach(): void {\n        this._form.appendChild(this._input);\n        this._form.addEventListener('submit', this._handleSubmit);\n\n        this._loadFonts();\n\n        this._eventPoster.setTarget(window.parent);\n        this._eventListener.listen();\n\n        // Assign itself to the global so it can be accessed by its sibling frames\n        (window as unknown as HostedInputWindow).hostedInput = this;\n\n        this._eventPoster.post({ type: HostedInputEventType.AttachSucceeded });\n    }\n\n    detach(): void {\n        if (this._input.parentElement) {\n            this._input.parentElement.removeChild(this._input);\n        }\n\n        this._form.removeEventListener('submit', this._handleSubmit);\n        this._unloadFonts();\n\n        this._eventListener.stopListen();\n    }\n\n    protected _formatValue(value: string): void {\n        this._input.value = value;\n    }\n\n    protected _notifyChange(_value: string): void {\n        this._eventPoster.post({\n            type: HostedInputEventType.Changed,\n            payload: {\n                fieldType: this._type,\n            },\n        });\n    }\n\n    private _configureInput(): void {\n        this._input.style.backgroundColor = 'transparent';\n        this._input.style.border = '0';\n        this._input.style.display = 'block';\n        this._input.style.height = '100%';\n        this._input.style.margin = '0';\n        this._input.style.outline = 'none';\n        this._input.style.padding = '0';\n        this._input.style.width = '100%';\n        this._input.id = kebabCase(this._type);\n        this._input.placeholder = this._placeholder;\n        this._input.autocomplete = this._autocomplete;\n\n        this._input.setAttribute('aria-label', this._accessibilityLabel);\n\n        this._applyStyles(this._styles.default);\n    }\n\n    private _applyStyles(styles: HostedInputStyles = {}): void {\n        const allowedStyles: { [key in keyof Required<HostedInputStyles>]: HostedInputStyles[key] } = {\n            color: styles.color,\n            fontFamily: styles.fontFamily,\n            fontSize: styles.fontSize,\n            fontWeight: styles.fontWeight,\n        };\n        const styleKeys = Object.keys(allowedStyles) as Array<keyof HostedInputStyles>;\n\n        styleKeys.forEach(key => {\n            if (!allowedStyles[key]) {\n                return;\n            }\n\n            this._input.style[key] = allowedStyles[key] || '';\n        });\n    }\n\n    private _loadFonts(): void {\n        if (this._fontLinks) {\n            return;\n        }\n\n        this._fontLinks = this._fontUrls\n            .filter(url => parseUrl(url).hostname === 'fonts.googleapis.com')\n            .filter(url => !document.querySelector(`link[href='${url}'][rel='stylesheet']`))\n            .map(url => {\n                const link = document.createElement('link');\n\n                link.rel = 'stylesheet';\n                link.href = url;\n\n                document.head.appendChild(link);\n\n                return link;\n            });\n    }\n\n    private _unloadFonts(): void {\n        if (!this._fontLinks) {\n            return;\n        }\n\n        this._fontLinks.forEach(link => {\n            if (!link.parentElement) {\n                return;\n            }\n\n            link.parentElement.removeChild(link);\n        });\n\n        this._fontLinks = undefined;\n    }\n\n    private async _validateForm(): Promise<void> {\n        const values = this._inputAggregator.getInputValues();\n        const results = await this._inputValidator.validate(values);\n\n        if (results.isValid) {\n            this._applyStyles(this._styles.default);\n        } else {\n            this._applyStyles(this._styles.error);\n        }\n\n        this._eventPoster.post({\n            type: HostedInputEventType.Validated,\n            payload: results,\n        });\n    }\n\n    private _processChange(value: string): void {\n        if (value === this._previousValue) {\n            return;\n        }\n\n        this._isTouched = true;\n\n        this._formatValue(value);\n        this._validateForm();\n        this._notifyChange(value);\n\n        this._previousValue = value;\n    }\n\n    private _handleInput: (event: Event) => void = event => {\n        const input = event.target as HTMLInputElement;\n\n        this._processChange(input.value);\n    };\n\n    private _handleBlur: (event: Event) => void = () => {\n        this._applyStyles(this._styles.default);\n        this._validateForm();\n\n        this._eventPoster.post({\n            type: HostedInputEventType.Blurred,\n            payload: {\n                fieldType: this._type,\n            },\n        });\n    };\n\n    private _handleFocus: (event: Event) => void = () => {\n        this._applyStyles(this._styles.focus);\n\n        this._eventPoster.post({\n            type: HostedInputEventType.Focused,\n            payload: {\n                fieldType: this._type,\n            },\n        });\n    };\n\n    private _handleValidate: (event: HostedFieldValidateRequestEvent) => void = () => {\n        this._validateForm();\n    };\n\n    private _handleSubmit: (event: Event) => void = event => {\n        event.preventDefault();\n\n        this._eventPoster.post({\n            type: HostedInputEventType.Entered,\n            payload: {\n                fieldType: this._type,\n            },\n        });\n    };\n}\n","import { IframeEventListener, IframeEventPoster } from '../../common/iframe';\nimport { HostedFieldEventMap } from '../hosted-field-events';\nimport HostedFieldType from '../hosted-field-type';\n\nimport CardExpiryFormatter from './card-expiry-formatter';\nimport HostedInput from './hosted-input';\nimport HostedInputAggregator from './hosted-input-aggregator';\nimport { HostedInputEvent } from './hosted-input-events';\nimport HostedInputPaymentHandler from './hosted-input-payment-handler';\nimport { HostedInputStylesMap } from './hosted-input-styles';\nimport HostedInputValidator from './hosted-input-validator';\n\nexport default class HostedCardExpiryInput extends HostedInput {\n    /**\n     * @internal\n     */\n    constructor(\n        form: HTMLFormElement,\n        placeholder: string,\n        accessibilityLabel: string,\n        autocomplete: string,\n        styles: HostedInputStylesMap,\n        fontUrls: string[],\n        eventListener: IframeEventListener<HostedFieldEventMap>,\n        eventPoster: IframeEventPoster<HostedInputEvent>,\n        inputAggregator: HostedInputAggregator,\n        inputValidator: HostedInputValidator,\n        paymentHandler: HostedInputPaymentHandler,\n        private _formatter: CardExpiryFormatter\n    ) {\n        super(\n            HostedFieldType.CardExpiry,\n            form,\n            placeholder,\n            accessibilityLabel,\n            autocomplete,\n            styles,\n            fontUrls,\n            eventListener,\n            eventPoster,\n            inputAggregator,\n            inputValidator,\n            paymentHandler\n        );\n    }\n\n    protected _formatValue(value: string): void {\n        this._input.value = this._formatter.format(value);\n    }\n}\n","import { number } from 'card-validator';\nimport { get } from 'lodash';\n\nimport { IframeEventListener, IframeEventPoster } from '../../common/iframe';\nimport { HostedFieldEventMap } from '../hosted-field-events';\nimport HostedFieldType from '../hosted-field-type';\n\nimport CardNumberFormatter from './card-number-formatter';\nimport HostedAutocompleteFieldset from './hosted-autocomplete-fieldset';\nimport HostedInput from './hosted-input';\nimport HostedInputAggregator from './hosted-input-aggregator';\nimport { HostedInputEvent, HostedInputEventType } from './hosted-input-events';\nimport HostedInputPaymentHandler from './hosted-input-payment-handler';\nimport { HostedInputStylesMap } from './hosted-input-styles';\nimport HostedInputValidator from './hosted-input-validator';\n\nexport default class HostedCardNumberInput extends HostedInput {\n    /**\n     * @internal\n     */\n    constructor(\n        type: HostedFieldType,\n        form: HTMLFormElement,\n        placeholder: string,\n        accessibilityLabel: string,\n        autocomplete: string,\n        styles: HostedInputStylesMap,\n        fontUrls: string[],\n        eventListener: IframeEventListener<HostedFieldEventMap>,\n        eventPoster: IframeEventPoster<HostedInputEvent>,\n        inputAggregator: HostedInputAggregator,\n        inputValidator: HostedInputValidator,\n        paymentHandler: HostedInputPaymentHandler,\n        private _autocompleteFieldset: HostedAutocompleteFieldset,\n        private _formatter: CardNumberFormatter\n    ) {\n        super(\n            type,\n            form,\n            placeholder,\n            accessibilityLabel,\n            autocomplete,\n            styles,\n            fontUrls,\n            eventListener,\n            eventPoster,\n            inputAggregator,\n            inputValidator,\n            paymentHandler\n        );\n    }\n\n    attach(): void {\n        super.attach();\n\n        this._autocompleteFieldset.attach();\n    }\n\n    protected _notifyChange(value: string): void {\n        const cardInfo = number(value).card;\n        const prevCardInfo = this._previousValue && number(this._previousValue).card;\n\n        if (get(prevCardInfo, 'type') !== get(cardInfo, 'type')) {\n            this._eventPoster.post({\n                type: HostedInputEventType.CardTypeChanged,\n                payload: {\n                    cardType: cardInfo ? cardInfo.type : undefined,\n                },\n            });\n        }\n\n        const unformattedValue = this._formatter.unformat(value);\n        const unformattedPreviousValue = this._previousValue ? this._formatter.unformat(this._previousValue) : '';\n\n        const bin = unformattedValue.length >= 6 && number(unformattedValue).isPotentiallyValid ? unformattedValue.substr(0, 6) : '';\n        const prevBin = unformattedPreviousValue.length >= 6 ? unformattedPreviousValue.substr(0, 6) : '';\n\n        if (bin !== prevBin) {\n            this._eventPoster.post({\n                type: HostedInputEventType.BinChanged,\n                payload: { bin },\n            });\n        }\n    }\n\n    protected _formatValue(value: string): void {\n        const selectionEnd = this._input.selectionEnd;\n        const formattedValue = this._formatter.format(value);\n\n        if (selectionEnd === value.length && value.length < formattedValue.length) {\n            this._input.setSelectionRange(formattedValue.length, formattedValue.length);\n        } else {\n            this._input.setSelectionRange(selectionEnd || 0, selectionEnd || 0);\n        }\n\n        this._input.value = formattedValue;\n    }\n}\n","import HostedInput from './hosted-input';\nimport HostedInputValues from './hosted-input-values';\nimport HostedInputWindow from './hosted-input-window';\n\nexport default class HostedInputAggregator {\n    constructor(\n        private _parentWindow: Window\n    ) {}\n\n    getInputs(filter?: (field: HostedInput) => boolean): HostedInput[] {\n        return Array.prototype.slice.call(this._parentWindow.frames)\n            .reduce((result: Window[], frame: Window) => {\n                try {\n                    const input = (frame as HostedInputWindow).hostedInput;\n\n                    if (!input || (filter && !filter(input))) {\n                        return result;\n                    }\n\n                    return [...result, input];\n                } catch (error) {\n                    if (error instanceof DOMException) {\n                        return result;\n                    }\n\n                    // IE11 doesn't throw `DOMException`\n                    if (error instanceof Error && error.message === 'Permission denied') {\n                        return result;\n                    }\n\n                    throw error;\n                }\n            }, []);\n    }\n\n    getInputValues(filter?: (field: HostedInput) => boolean): HostedInputValues {\n        return this.getInputs(filter)\n            .reduce((result, input) => {\n                return {\n                    ...result,\n                    [input.getType()]: input.getValue(),\n                };\n            }, {} as HostedInputValues);\n    }\n}\n","import { Response } from '@bigcommerce/request-sender';\nimport { snakeCase } from 'lodash';\n\nimport { PaymentErrorResponseBody } from '../../common/error';\nimport { IframeEventPoster } from '../../common/iframe';\nimport { PaymentRequestSender, PaymentRequestTransformer } from '../../payment';\nimport { InvalidHostedFormValueError } from '../errors';\nimport { HostedFieldSubmitRequestEvent } from '../hosted-field-events';\n\nimport HostedInputAggregator from './hosted-input-aggregator';\nimport { HostedInputEvent, HostedInputEventType } from './hosted-input-events';\nimport HostedInputStorage from './hosted-input-storage';\nimport HostedInputValidator from './hosted-input-validator';\n\nexport default class HostedInputPaymentHandler {\n    constructor(\n        private _inputAggregator: HostedInputAggregator,\n        private _inputValidator: HostedInputValidator,\n        private _inputStorage: HostedInputStorage,\n        private _eventPoster: IframeEventPoster<HostedInputEvent>,\n        private _paymentRequestSender: PaymentRequestSender,\n        private _paymentRequestTransformer: PaymentRequestTransformer\n    ) {}\n\n    handle: (event: HostedFieldSubmitRequestEvent) => Promise<void> = async ({ payload: { data } }) => {\n        const values = this._inputAggregator.getInputValues();\n        const results = await this._inputValidator.validate(values);\n\n        this._eventPoster.post({\n            type: HostedInputEventType.Validated,\n            payload: results,\n        });\n\n        if (!results.isValid) {\n            const error = new InvalidHostedFormValueError(results.errors);\n\n            return this._eventPoster.post({\n                type: HostedInputEventType.SubmitFailed,\n                payload: {\n                    error: { code: snakeCase(error.name), message: error.message },\n                },\n            });\n        }\n\n        try {\n            await this._paymentRequestSender.submitPayment(\n                this._paymentRequestTransformer.transformWithHostedFormData(\n                    values,\n                    data,\n                    this._inputStorage.getNonce() || ''\n                )\n            );\n\n            this._eventPoster.post({ type: HostedInputEventType.SubmitSucceeded });\n        } catch (error) {\n            this._eventPoster.post({\n                type: HostedInputEventType.SubmitFailed,\n                payload: this._isPaymentErrorResponse(error) ?\n                    { error: error.body.errors[0], response: error } :\n                    { error: { code: snakeCase(error.name), message: error.message } },\n            });\n        }\n    };\n\n    private _isPaymentErrorResponse(response: any): response is Response<PaymentErrorResponseBody> {\n        const { body: { errors = [] } = {} } = response || {};\n\n        return (\n            typeof (errors[0] && errors[0].code) === 'string' &&\n            typeof (errors[0] && errors[0].message) === 'string'\n        );\n    }\n}\n","import { creditCardType, cvv, expirationDate, number } from 'card-validator';\nimport { includes } from 'lodash';\nimport { object, string, StringSchema, ValidationError } from 'yup';\n\nimport { CardInstrument } from '../../payment/instrument';\nimport HostedFieldType from '../hosted-field-type';\n\nimport { HostedInputValidateErrorDataMap } from './hosted-input-validate-error-data';\nimport HostedInputValidateResults from './hosted-input-validate-results';\nimport HostedInputValues from './hosted-input-values';\n\nexport default class HostedInputValidator {\n    constructor(\n        private _cardInstrument?: CardInstrument\n    ) {\n        this._configureCardValidator();\n    }\n\n    async validate(values: HostedInputValues): Promise<HostedInputValidateResults> {\n        const requiredFields = Object.keys(values);\n        const schemas: { [key in keyof HostedInputValues]: StringSchema } = {};\n        const results: HostedInputValidateResults = {\n            errors: {},\n            isValid: true,\n        };\n\n        if (includes(requiredFields, HostedFieldType.CardCode)) {\n            schemas.cardCode = this._getCardCodeSchema();\n            results.errors.cardCode = [];\n        }\n\n        if (includes(requiredFields, HostedFieldType.CardCodeVerification)) {\n            schemas.cardCodeVerification = this._getCardCodeVerificationSchema();\n            results.errors.cardCodeVerification = [];\n        }\n\n        if (includes(requiredFields, HostedFieldType.CardExpiry)) {\n            schemas.cardExpiry = this._getCardExpirySchema();\n            results.errors.cardExpiry = [];\n        }\n\n        if (includes(requiredFields, HostedFieldType.CardName)) {\n            schemas.cardName = this._getCardNameSchema();\n            results.errors.cardName = [];\n        }\n\n        if (includes(requiredFields, HostedFieldType.CardNumber)) {\n            schemas.cardNumber = this._getCardNumberSchema();\n            results.errors.cardNumber = [];\n        }\n\n        if (includes(requiredFields, HostedFieldType.CardNumberVerification)) {\n            schemas.cardNumberVerification = this._getCardNumberVerificationSchema();\n            results.errors.cardNumberVerification = [];\n        }\n\n        try {\n            await object(schemas)\n                .validate(values, { abortEarly: false });\n\n            return results;\n        } catch (error) {\n            if (error.name !== 'ValidationError') {\n                throw error;\n            }\n\n            return {\n                errors: (Object.keys(results.errors) as Array<keyof HostedInputValidateErrorDataMap>)\n                    .reduce((result, fieldType) => ({\n                        ...result,\n                        [fieldType]: (error as ValidationError).inner\n                            .filter(innerError => innerError.path === fieldType)\n                            .map(innerError => ({\n                                fieldType: innerError.path,\n                                message: innerError.errors.join(' '),\n                                type: innerError.type,\n                            })),\n                    }), {} as HostedInputValidateErrorDataMap),\n                isValid: false,\n            };\n        }\n    }\n\n    private _configureCardValidator(): void {\n        const discoverInfo = creditCardType.getTypeInfo('discover');\n        const visaInfo = creditCardType.getTypeInfo('visa');\n\n        // Need to support 13 digit PAN because some gateways only provide test credit card numbers in this format.\n        creditCardType.updateCard('visa', {\n            lengths: [13, ...(visaInfo.lengths || [])],\n        });\n\n        // Add support for 8-BIN Discover Cards.\n        creditCardType.updateCard('discover', {\n            patterns: [\n                ...(discoverInfo.patterns || []),\n                [810, 817],\n            ],\n        });\n\n        creditCardType.addCard({\n            niceType: 'Mada',\n            type: 'mada',\n            patterns: [\n                400861, 401757, 407197, 407395, 409201,\n                410685, 412565, 417633, 419593, 422817,\n                422818, 422819, 428331, 428671, 428672,\n                428673, 431361, 432328, 434107, 439954,\n                440533, 440647, 440795, 445564, 446393,\n                446404, 446672, 455036, 455708, 457865,\n                458456, 462220, 468540, 468541, 468542,\n                468543, 483010, 483011, 483012, 484783,\n                486094, 486095, 486096, 489317, 489318,\n                489319, 493428, 504300, 506968, 508160,\n                513213, 520058, 521076, 524130, 524514,\n                529415, 529741, 530060, 530906, 531095,\n                531196, 532013, 535825, 535989, 536023,\n                537767, 539931, 543085, 543357, 549760,\n                554180, 557606, 558848, 585265, 588845,\n                588846, 588847, 588848, 588849, 588850,\n                588851, 588982, 588983, 589005, 589206,\n                604906, 605141, 636120, 968201, 968202,\n                968203, 968204, 968205, 968206, 968207,\n                968208, 968209, 968210, 968211,\n            ],\n            gaps: [4, 8, 12],\n            lengths: [16, 18, 19],\n            code: {\n                name: 'CVV',\n                size: 3,\n            },\n        });\n    }\n\n    private _getCardCodeSchema(): StringSchema {\n        return string()\n            .required('CVV is required')\n            .test({\n                message: 'CVV must be valid',\n                name: 'invalid_card_code',\n                test(value) {\n                    const { card } = number((this.parent as HostedInputValues).cardNumber || '');\n\n                    return cvv(value, card && card.code ? card.code.size : undefined).isValid;\n                },\n            });\n    }\n\n    private _getCardCodeVerificationSchema(): StringSchema {\n        return string()\n            .required('CVV is required')\n            .test({\n                message: 'CVV must be valid',\n                name: 'invalid_card_code',\n                test: (value = '') => {\n                    const cardType = this._cardInstrument && this._mapFromInstrumentCardType(this._cardInstrument.brand);\n                    const cardInfo = cardType && creditCardType.getTypeInfo(cardType);\n\n                    return cvv(value, cardInfo && cardInfo.code ? cardInfo.code.size : undefined).isValid;\n                },\n            });\n    }\n\n    private _getCardExpirySchema(): StringSchema {\n        return string()\n            .required('Expiration date is required')\n            .test({\n                message: 'Expiration date must be a valid future date in MM / YY format',\n                name: 'invalid_card_expiry',\n                test: value => expirationDate(value).isValid,\n            });\n    }\n\n    private _getCardNameSchema(): StringSchema {\n        return string()\n            .max(200)\n            .required('Full name is required');\n    }\n\n    private _getCardNumberSchema(): StringSchema {\n        return string()\n            .required('Credit card number is required')\n            .test({\n                message: 'Credit card number must be valid',\n                name: 'invalid_card_number',\n                test: value => number(value).isValid,\n            });\n    }\n\n    private _getCardNumberVerificationSchema(): StringSchema {\n        return string()\n            .required('Credit card number is required')\n            .test({\n                message: 'Credit card number must be valid',\n                name: 'invalid_card_number',\n                test: (value = '') => number(value).isValid,\n            })\n            .test({\n                message: 'The card number entered does not match the card stored in your account',\n                name: 'mismatched_card_number',\n                test: (value = '') => this._cardInstrument ?\n                    value.slice(-this._cardInstrument.last4.length) === this._cardInstrument.last4 :\n                    false,\n            });\n    }\n\n    private _mapFromInstrumentCardType(type: string): string {\n        switch (type) {\n        case 'amex':\n        case 'american_express':\n            return 'american-express';\n\n        case 'diners':\n            return 'diners-club';\n\n        default:\n            return type;\n        }\n    }\n}\n","import { createClient as createBigpayClient } from '@bigcommerce/bigpay-client';\n\nimport { IframeEventListener, IframeEventPoster } from '../../common/iframe';\nimport { PaymentRequestSender, PaymentRequestTransformer } from '../../payment';\nimport { CardInstrument } from '../../payment/instrument';\nimport HostedFieldType from '../hosted-field-type';\n\nimport CardExpiryFormatter from './card-expiry-formatter';\nimport CardNumberFormatter from './card-number-formatter';\nimport getHostedInputStorage from './get-hosted-input-storage';\nimport HostedAutocompleteFieldset from './hosted-autocomplete-fieldset';\nimport HostedCardExpiryInput from './hosted-card-expiry-input';\nimport HostedCardNumberInput from './hosted-card-number-input';\nimport HostedInput from './hosted-input';\nimport HostedInputAggregator from './hosted-input-aggregator';\nimport HostedInputPaymentHandler from './hosted-input-payment-handler';\nimport { HostedInputStylesMap } from './hosted-input-styles';\nimport HostedInputValidator from './hosted-input-validator';\nimport mapToAccessibilityLabel from './map-to-accessibility-label';\nimport mapToAutocompleteType from './map-to-autocomplete-type';\n\nexport default class HostedInputFactory {\n    constructor(\n        private _parentOrigin: string\n    ) {}\n\n    create(\n        form: HTMLFormElement,\n        type: HostedFieldType,\n        styles: HostedInputStylesMap = {},\n        fontUrls: string[] = [],\n        placeholder: string = '',\n        accessibilityLabel: string = mapToAccessibilityLabel(type),\n        cardInstrument?: CardInstrument\n    ): HostedInput {\n        const autocomplete = mapToAutocompleteType(type);\n\n        if (type === HostedFieldType.CardNumber) {\n            return this._createNumberInput(type, form, styles, fontUrls, placeholder, accessibilityLabel, autocomplete);\n        }\n\n        if (type === HostedFieldType.CardNumberVerification) {\n            return this._createNumberInput(type, form, styles, fontUrls, placeholder, accessibilityLabel, autocomplete, cardInstrument);\n        }\n\n        if (type === HostedFieldType.CardExpiry) {\n            return this._createExpiryInput(form, styles, fontUrls, placeholder, accessibilityLabel, autocomplete);\n        }\n\n        if (type === HostedFieldType.CardCodeVerification) {\n            return this._createInput(type, form, styles, fontUrls, placeholder, accessibilityLabel, autocomplete, cardInstrument);\n        }\n\n        return this._createInput(type, form, styles, fontUrls, placeholder, accessibilityLabel, autocomplete);\n    }\n\n    private _createExpiryInput(\n        form: HTMLFormElement,\n        styles: HostedInputStylesMap,\n        fontUrls: string[],\n        placeholder: string,\n        accessibilityLabel: string = '',\n        autocomplete: string = ''\n    ): HostedCardExpiryInput {\n        return new HostedCardExpiryInput(\n            form,\n            placeholder,\n            accessibilityLabel,\n            autocomplete,\n            styles,\n            fontUrls,\n            new IframeEventListener(this._parentOrigin),\n            new IframeEventPoster(this._parentOrigin, window.parent),\n            new HostedInputAggregator(window.parent),\n            new HostedInputValidator(),\n            this._createPaymentHandler(),\n            new CardExpiryFormatter()\n        );\n    }\n\n    private _createNumberInput(\n        type: HostedFieldType,\n        form: HTMLFormElement,\n        styles: HostedInputStylesMap,\n        fontUrls: string[],\n        placeholder: string,\n        accessibilityLabel: string = '',\n        autocomplete: string = '',\n        cardInstrument?: CardInstrument\n    ): HostedCardNumberInput {\n        return new HostedCardNumberInput(\n            type,\n            form,\n            placeholder,\n            accessibilityLabel,\n            autocomplete,\n            styles,\n            fontUrls,\n            new IframeEventListener(this._parentOrigin),\n            new IframeEventPoster(this._parentOrigin, window.parent),\n            new HostedInputAggregator(window.parent),\n            new HostedInputValidator(cardInstrument),\n            this._createPaymentHandler(cardInstrument),\n            new HostedAutocompleteFieldset(\n                form,\n                [HostedFieldType.CardCode, HostedFieldType.CardExpiry, HostedFieldType.CardName],\n                new HostedInputAggregator(window.parent)\n            ),\n            new CardNumberFormatter()\n        );\n    }\n\n    private _createInput(\n        type: HostedFieldType,\n        form: HTMLFormElement,\n        styles: HostedInputStylesMap,\n        fontUrls: string[],\n        placeholder: string,\n        accessibilityLabel: string = '',\n        autocomplete: string = '',\n        cardInstrument?: CardInstrument\n    ): HostedInput {\n        return new HostedInput(\n            type,\n            form,\n            placeholder,\n            accessibilityLabel,\n            autocomplete,\n            styles,\n            fontUrls,\n            new IframeEventListener(this._parentOrigin),\n            new IframeEventPoster(this._parentOrigin, window.parent),\n            new HostedInputAggregator(window.parent),\n            new HostedInputValidator(cardInstrument),\n            this._createPaymentHandler(cardInstrument)\n        );\n    }\n\n    private _createPaymentHandler(\n        cardInstrument?: CardInstrument\n    ): HostedInputPaymentHandler {\n        return new HostedInputPaymentHandler(\n            new HostedInputAggregator(window.parent),\n            new HostedInputValidator(cardInstrument),\n            getHostedInputStorage(),\n            new IframeEventPoster(this._parentOrigin, window.parent),\n            new PaymentRequestSender(createBigpayClient()),\n            new PaymentRequestTransformer()\n        );\n    }\n}\n","import HostedFieldType from '../hosted-field-type';\n\nexport default function mapToAccessibilityLabel(type: HostedFieldType): string {\n    switch (type) {\n    case HostedFieldType.CardCode:\n    case HostedFieldType.CardCodeVerification:\n        return 'CVC';\n\n    case HostedFieldType.CardExpiry:\n        return 'Expiration';\n\n    case HostedFieldType.CardName:\n        return 'Name on card';\n\n    case HostedFieldType.CardNumber:\n    case HostedFieldType.CardNumberVerification:\n        return 'Credit card number';\n    }\n}\n","import { fromEvent } from 'rxjs';\nimport { map, take } from 'rxjs/operators';\n\nimport { IframeEventListener } from '../../common/iframe';\nimport { InvalidHostedFormConfigError } from '../errors';\nimport { HostedFieldAttachEvent, HostedFieldEventMap, HostedFieldEventType } from '../hosted-field-events';\n\nimport HostedInput from './hosted-input';\nimport HostedInputFactory from './hosted-input-factory';\nimport HostedInputStorage from './hosted-input-storage';\n\ninterface EventTargetLike<TEvent> {\n    addListener(eventName: string, handler: (event: TEvent) => void): void;\n    removeListener(eventName: string, handler: (event: TEvent) => void): void;\n}\n\nexport default class HostedInputInitializer {\n    constructor(\n        private _factory: HostedInputFactory,\n        private _storage: HostedInputStorage,\n        private _eventListener: IframeEventListener<HostedFieldEventMap>\n    ) {}\n\n    initialize(containerId: string, nonce?: string): Promise<HostedInput> {\n        if (nonce) {\n            this._storage.setNonce(nonce);\n        }\n\n        const form = this._createFormContainer(containerId);\n\n        this._resetPageStyles(containerId);\n        this._eventListener.listen();\n\n        return fromEvent<HostedFieldAttachEvent>(\n            this._eventListener as EventTargetLike<HostedFieldAttachEvent>,\n            HostedFieldEventType.AttachRequested\n        )\n            .pipe(\n                map(({ payload }) => {\n                    const { accessibilityLabel, cardInstrument, fontUrls, placeholder, styles, type } = payload;\n                    const field = this._factory.create(form, type, styles, fontUrls, placeholder, accessibilityLabel, cardInstrument);\n\n                    field.attach();\n\n                    return field;\n                }),\n                take(1)\n            )\n            .toPromise();\n    }\n\n    private _resetPageStyles(containerId: string) {\n        const html = document.querySelector('html');\n        const body = document.querySelector('body');\n        const container = document.getElementById(containerId);\n\n        [html, body, container]\n            .forEach(node => {\n                if (!node) {\n                    return;\n                }\n\n                node.style.height = '100%';\n                node.style.width = '100%';\n                node.style.overflow = 'hidden';\n                node.style.padding = '0';\n                node.style.margin = '0';\n            });\n    }\n\n    private _createFormContainer(containerId: string): HTMLFormElement {\n        const container = document.getElementById(containerId);\n\n        if (!container) {\n            throw new InvalidHostedFormConfigError('Unable to proceed because the provided container ID is not valid.');\n        }\n\n        const form = document.createElement('form');\n        const button = document.createElement('button');\n\n        form.noValidate = true;\n        form.style.height = '100%';\n        form.style.width = '100%';\n        button.style.display = 'none';\n\n        container.appendChild(form);\n        form.appendChild(button);\n\n        return form;\n    }\n}\n","import { IframeEventListener } from '../../common/iframe';\nimport { HostedFieldEventMap } from '../hosted-field-events';\n\nimport getHostedInputStorage from './get-hosted-input-storage';\nimport HostedInput from './hosted-input';\nimport HostedInputFactory from './hosted-input-factory';\nimport HostedInputInitializer from './hosted-input-initializer';\nimport HostedInputOptions from './hosted-input-options';\n\nexport default function initializeHostedInput(options: HostedInputOptions): Promise<HostedInput> {\n    const { containerId, nonce, parentOrigin } = options;\n    const initializer = new HostedInputInitializer(\n        new HostedInputFactory(parentOrigin),\n        getHostedInputStorage(),\n        new IframeEventListener<HostedFieldEventMap>(parentOrigin)\n    );\n\n    return initializer.initialize(containerId, nonce);\n}\n","import { IframeEventPoster } from '../../common/iframe';\n\nimport { HostedInputAttachErrorEvent, HostedInputEventType } from './hosted-input-events';\nimport HostedInputInitializeErrorData from './hosted-input-initialize-error-data';\n\nconst poster = new IframeEventPoster<HostedInputAttachErrorEvent>('*', window.parent);\n\nexport default function notifyInitializeError(error: HostedInputInitializeErrorData): void {\n    poster.post({\n        type: HostedInputEventType.AttachFailed,\n        payload: { error },\n    });\n}\n","export { initializeHostedInput, notifyInitializeError } from '../hosted-form/iframe-content';\n","module.exports = require(\"lodash\");","import { setPrototypeOf } from '../../utility';\n\nimport CustomError from './custom-error';\n\n/**\n * This error type should not be constructed directly. It is a base class for\n * all custom errors thrown in this library.\n */\nexport default abstract class StandardError extends Error implements CustomError {\n    name = 'StandardError';\n    type = 'standard';\n\n    constructor(message?: string) {\n        super(message || 'An unexpected error has occurred.');\n\n        setPrototypeOf(this, new.target.prototype);\n\n        if (typeof Error.captureStackTrace === 'function') {\n            Error.captureStackTrace(this, new.target);\n        } else {\n            this.stack = (new Error(this.message)).stack;\n        }\n    }\n}\n","export default function setPrototypeOf(object: any, prototype: object) {\n    if (Object.setPrototypeOf) {\n        Object.setPrototypeOf(object, prototype);\n    } else {\n        object.__proto__ = prototype;\n    }\n\n    return object;\n}\n","module.exports = require(\"rxjs\");","module.exports = require(\"card-validator\");","import { FormattedPayload, FormattedVaultedInstrument, HostedVaultedInstrument, PaymentInstrument, VaultedInstrument } from './payment';\n\nexport default function isVaultedInstrument(instrument: PaymentInstrument): instrument is VaultedInstrument {\n    return Boolean((instrument as VaultedInstrument).instrumentId);\n}\n\nexport function isHostedVaultedInstrument(instrument: PaymentInstrument): instrument is HostedVaultedInstrument {\n    return (\n        Boolean((instrument as HostedVaultedInstrument).instrumentId) &&\n        !instrument.hasOwnProperty('ccNumber') &&\n        !instrument.hasOwnProperty('ccCvv')\n    );\n}\n\nexport function isFormattedVaultedInstrument(instrument: PaymentInstrument): instrument is FormattedPayload<FormattedVaultedInstrument> {\n    const formattedInstrument = (instrument as FormattedPayload<FormattedVaultedInstrument>).formattedPayload;\n\n    if (!formattedInstrument) {\n        return false;\n    }\n\n    return typeof formattedInstrument.bigpay_token === 'string' ||\n        Boolean(formattedInstrument.bigpay_token && formattedInstrument.bigpay_token.token);\n}\n","import { Response } from '@bigcommerce/request-sender';\n\nimport { PaymentErrorData, PaymentErrorResponseBody } from '../../common/error';\nimport HostedFieldType from '../hosted-field-type';\n\nimport HostedInputInitializeErrorData from './hosted-input-initialize-error-data';\nimport HostedInputValidateResults from './hosted-input-validate-results';\n\n// Event types\nexport enum HostedInputEventType {\n    AttachSucceeded = 'HOSTED_INPUT:ATTACH_SUCCEEDED',\n    AttachFailed = 'HOSTED_INPUT:ATTACH_FAILED',\n    BinChanged = 'HOSTED_INPUT:BIN_CHANGED',\n    Blurred = 'HOSTED_INPUT:BLURRED',\n    Changed = 'HOSTED_INPUT:CHANGED',\n    CardTypeChanged = 'HOSTED_INPUT:CARD_TYPE_CHANGED',\n    Entered = 'HOSTED_INPUT:ENTERED',\n    Focused = 'HOSTED_INPUT:FOCUSED',\n    SubmitSucceeded = 'HOSTED_INPUT:SUBMIT_SUCCEEDED',\n    SubmitFailed = 'HOSTED_INPUT:SUBMIT_FAILED',\n    Validated = 'HOSTED_INPUT:VALIDATED',\n}\n\n// Event mapping\nexport interface HostedInputEventMap {\n    [HostedInputEventType.AttachSucceeded]: HostedInputAttachSuccessEvent;\n    [HostedInputEventType.AttachFailed]: HostedInputAttachErrorEvent;\n    [HostedInputEventType.BinChanged]: HostedInputBinChangeEvent;\n    [HostedInputEventType.Blurred]: HostedInputBlurEvent;\n    [HostedInputEventType.Changed]: HostedInputChangeEvent;\n    [HostedInputEventType.CardTypeChanged]: HostedInputCardTypeChangeEvent;\n    [HostedInputEventType.Entered]: HostedInputEnterEvent;\n    [HostedInputEventType.Focused]: HostedInputFocusEvent;\n    [HostedInputEventType.SubmitSucceeded]: HostedInputSubmitSuccessEvent;\n    [HostedInputEventType.SubmitFailed]: HostedInputSubmitErrorEvent;\n    [HostedInputEventType.Validated]: HostedInputValidateEvent;\n}\n\n// Events\nexport type HostedInputEvent = (\n    HostedInputAttachSuccessEvent |\n    HostedInputAttachErrorEvent |\n    HostedInputBinChangeEvent |\n    HostedInputBlurEvent |\n    HostedInputChangeEvent |\n    HostedInputCardTypeChangeEvent |\n    HostedInputEnterEvent |\n    HostedInputFocusEvent |\n    HostedInputSubmitSuccessEvent |\n    HostedInputSubmitErrorEvent |\n    HostedInputValidateEvent\n);\n\nexport interface HostedInputAttachSuccessEvent {\n    type: HostedInputEventType.AttachSucceeded;\n}\n\nexport interface HostedInputAttachErrorEvent {\n    type: HostedInputEventType.AttachFailed;\n    payload: {\n        error: HostedInputInitializeErrorData;\n    };\n}\n\nexport interface HostedInputBinChangeEvent {\n    type: HostedInputEventType.BinChanged;\n    payload: {\n        bin?: string;\n    };\n}\n\nexport interface HostedInputBlurEvent {\n    type: HostedInputEventType.Blurred;\n    payload: {\n        fieldType: HostedFieldType;\n    };\n}\n\nexport interface HostedInputChangeEvent {\n    type: HostedInputEventType.Changed;\n    payload: {\n        fieldType: HostedFieldType;\n    };\n}\n\nexport interface HostedInputCardTypeChangeEvent {\n    type: HostedInputEventType.CardTypeChanged;\n    payload: {\n        cardType?: string;\n    };\n}\n\nexport interface HostedInputFocusEvent {\n    type: HostedInputEventType.Focused;\n    payload: {\n        fieldType: HostedFieldType;\n    };\n}\n\nexport interface HostedInputEnterEvent {\n    type: HostedInputEventType.Entered;\n    payload: {\n        fieldType: HostedFieldType;\n    };\n}\n\nexport interface HostedInputSubmitSuccessEvent {\n    type: HostedInputEventType.SubmitSucceeded;\n}\n\nexport interface HostedInputSubmitErrorEvent {\n    type: HostedInputEventType.SubmitFailed;\n    payload: {\n        error: PaymentErrorData;\n        response?: Response<PaymentErrorResponseBody>;\n    };\n}\n\nexport interface HostedInputValidateEvent {\n    type: HostedInputEventType.Validated;\n    payload: HostedInputValidateResults;\n}\n","module.exports = require(\"local-storage-fallback\");","import StandardError from './standard-error';\n\n/**\n * This error should be thrown when a method is unable to proceed because the\n * caller has not provided all the arguments according to their requirements,\n * i.e.: if an argument is missing or it is not the expected data type.\n */\nexport default class InvalidArgumentError extends StandardError {\n    constructor(message?: string) {\n        super(message || 'Invalid arguments have been provided.');\n\n        this.name = 'InvalidArgumentError';\n        this.type = 'invalid_argument';\n    }\n}\n","import IframeEvent from './iframe-event';\n\nexport default function isIframeEvent<TEvent extends IframeEvent<TType>, TType extends string>(\n    object: any,\n    type: TType\n): object is TEvent {\n    return object.type === type;\n}\n","export const HOSTED = 'PAYMENT_TYPE_HOSTED';\nexport const OFFLINE = 'PAYMENT_TYPE_OFFLINE';\n","import { isBillingAddressLike, BillingAddress } from '../billing';\nimport { Consignment } from '../shipping';\n\nimport Address from './address';\nimport InternalAddress from './internal-address';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalAddress(\n    address: Address | BillingAddress,\n    consignments?: Consignment[]\n): InternalAddress<any> {\n    let addressId;\n\n    if (isBillingAddressLike(address)) {\n        addressId = address.id;\n    } else if (consignments && consignments.length) {\n        addressId = consignments[0].id;\n    }\n\n    return {\n        id: addressId,\n        firstName: address.firstName,\n        lastName: address.lastName,\n        company: address.company,\n        addressLine1: address.address1,\n        addressLine2: address.address2,\n        city: address.city,\n        province: address.stateOrProvince,\n        provinceCode: address.stateOrProvinceCode,\n        postCode: address.postalCode,\n        country: address.country,\n        countryCode: address.countryCode,\n        phone: address.phone,\n        customFields: address.customFields,\n    };\n}\n","import InternalLineItem from './internal-line-item';\nimport { LineItem } from './line-item';\nimport LineItemMap from './line-item-map';\nimport mapGiftCertificateToInternalLineItem from './map-gift-certificate-to-internal-line-item';\nimport mapToInternalLineItem from './map-to-internal-line-item';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalLineItems(\n    itemMap: LineItemMap,\n    decimalPlaces: number,\n    idKey: keyof LineItem = 'id'\n): InternalLineItem[] {\n    return (Object.keys(itemMap) as Array<keyof LineItemMap>)\n        .reduce((result, key) => [\n            ...result,\n            ...(itemMap[key] as LineItem[]).map((item: any) => {\n                if (key === 'giftCertificates') {\n                    return mapGiftCertificateToInternalLineItem(item, decimalPlaces);\n                }\n\n                return mapToInternalLineItem(\n                    item,\n                    mapToInternalLineItemType(key),\n                    decimalPlaces,\n                    idKey\n                );\n            }),\n        ], [] as InternalLineItem[]);\n}\n\nfunction mapToInternalLineItemType(type: string): string {\n    switch (type) {\n        case 'physicalItems':\n            return 'ItemPhysicalEntity';\n\n        case 'digitalItems':\n            return 'ItemDigitalEntity';\n\n        case 'giftCertificates':\n            return 'ItemGiftCertificateEntity';\n\n        default:\n            return '';\n    }\n}\n","import { AmountTransformer } from '../common/utility';\n\nimport InternalLineItem from './internal-line-item';\nimport { GiftCertificateItem } from './line-item';\n\nexport default function mapGiftCertificateToInternalLineItem(\n    item: GiftCertificateItem,\n    decimalPlaces: number\n): InternalLineItem {\n    const amountTransformer = new AmountTransformer(decimalPlaces);\n\n    return {\n        id: item.id,\n        imageUrl: '',\n        name: item.name,\n        amount: item.amount,\n        amountAfterDiscount: item.amount,\n        discount: 0,\n        integerAmount: amountTransformer.toInteger(item.amount),\n        integerAmountAfterDiscount: amountTransformer.toInteger(item.amount),\n        integerUnitPrice: amountTransformer.toInteger(item.amount),\n        integerUnitPriceAfterDiscount: amountTransformer.toInteger(item.amount),\n        integerDiscount: 0,\n        quantity: 1,\n        sender: item.sender,\n        recipient: item.recipient,\n        type: 'ItemGiftCertificateEntity',\n        attributes: [],\n        variantId: null,\n    };\n}\n","import { CardInstrument } from '../payment/instrument';\n\nimport HostedFieldType from './hosted-field-type';\nimport { HostedFieldStylesMap } from './hosted-form-options';\nimport HostedFormOrderData from './hosted-form-order-data';\n\nexport enum HostedFieldEventType {\n    AttachRequested = 'HOSTED_FIELD:ATTACH_REQUESTED',\n    SubmitRequested = 'HOSTED_FIELD:SUBMITTED_REQUESTED',\n    ValidateRequested = 'HOSTED_FIELD:VALIDATE_REQUESTED',\n}\n\nexport interface HostedFieldEventMap {\n    [HostedFieldEventType.AttachRequested]: HostedFieldAttachEvent;\n    [HostedFieldEventType.SubmitRequested]: HostedFieldSubmitRequestEvent;\n    [HostedFieldEventType.ValidateRequested]: HostedFieldValidateRequestEvent;\n}\n\nexport type HostedFieldEvent = (\n    HostedFieldAttachEvent |\n    HostedFieldSubmitRequestEvent |\n    HostedFieldValidateRequestEvent\n);\n\nexport interface HostedFieldAttachEvent {\n    type: HostedFieldEventType.AttachRequested;\n    payload: {\n        accessibilityLabel?: string;\n        cardInstrument?: CardInstrument;\n        fontUrls?: string[];\n        placeholder?: string;\n        styles?: HostedFieldStylesMap;\n        type: HostedFieldType;\n    };\n}\n\nexport interface HostedFieldSubmitRequestEvent {\n    type: HostedFieldEventType.SubmitRequested;\n    payload: {\n        data: HostedFormOrderData;\n        fields: HostedFieldType[];\n    };\n}\n\nexport interface HostedFieldValidateRequestEvent {\n    type: HostedFieldEventType.ValidateRequested;\n}\n","import { AmountTransformer } from '../common/utility';\n\nimport InternalLineItem from './internal-line-item';\nimport { DigitalItem, LineItem } from './line-item';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalLineItem(\n    item: LineItem,\n    type: string,\n    decimalPlaces: number,\n    idKey: keyof LineItem = 'id'\n): InternalLineItem {\n    const amountTransformer = new AmountTransformer(decimalPlaces);\n\n    return {\n        id: (item[idKey] as string | number),\n        imageUrl: item.imageUrl,\n        amount: item.extendedListPrice,\n        amountAfterDiscount: item.extendedSalePrice,\n        discount: item.discountAmount,\n        integerAmount: amountTransformer.toInteger(item.extendedListPrice),\n        integerAmountAfterDiscount: amountTransformer.toInteger(item.extendedSalePrice),\n        integerDiscount: amountTransformer.toInteger(item.discountAmount),\n        integerUnitPrice: amountTransformer.toInteger(item.listPrice),\n        integerUnitPriceAfterDiscount: amountTransformer.toInteger(item.salePrice),\n        downloadsPageUrl: (item as DigitalItem).downloadPageUrl,\n        name: item.name,\n        quantity: item.quantity,\n        brand: item.brand,\n        sku: item.sku,\n        categoryNames: item.categoryNames,\n        variantId: item.variantId,\n        productId: item.productId,\n        attributes: (item.options || []).map(option => ({\n            name: option.name,\n            value: option.value,\n        })),\n        addedByPromotion: item.addedByPromotion,\n        type,\n    };\n}\n","import InternalShippingOption from './internal-shipping-option';\nimport ShippingOption from './shipping-option';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalShippingOption(option: ShippingOption, isSelected: boolean): InternalShippingOption {\n    return {\n        description: option.description,\n        module: option.type,\n        price: option.cost,\n        id: option.id,\n        selected: isSelected,\n        isRecommended: option.isRecommended,\n        imageUrl: option.imageUrl,\n        transitTime: option.transitTime,\n    };\n}\n","module.exports = require(\"rxjs/operators\");","export default class AmountTransformer {\n    constructor(private _decimalPlaces: number) {}\n\n    toInteger(amount: number): number {\n        return Math.round(amount * Math.pow(10, this._decimalPlaces));\n    }\n}\n","import { InvalidArgumentError } from '../error/errors';\n\nimport Url from './url';\n\nexport default function parseUrl(url: string): Url {\n    if (!/^(https?:)?\\/\\//.test(url)) {\n        throw new InvalidArgumentError('The provided URL must be absolute.');\n    }\n\n    // new URL() is not supported in IE11, use anchor tag instead\n    const anchor = document.createElement('a');\n\n    anchor.href = url;\n\n    // IE11 returns 80 or 443 for the port number depending on the URL scheme,\n    // even if the port number is not specified in the URL.\n    const port = anchor.port && url.indexOf(`${anchor.hostname}:${anchor.port}`) !== -1 ?\n        anchor.port :\n        '';\n\n    return {\n        hash: anchor.hash,\n        hostname: anchor.hostname,\n        href: anchor.href,\n        origin: `${anchor.protocol}//${anchor.hostname}${port ? ':' + port : ''}`,\n        pathname: anchor.pathname,\n        port,\n        protocol: anchor.protocol,\n        search: anchor.search,\n    };\n}\n","module.exports = require(\"yup\");","/**\n * Decorates a class or a method by binding all its prototype methods or itself\n * to the calling instance respectively.\n */\nfunction bindDecorator<T extends Method>(target: object, key: string, descriptor: TypedPropertyDescriptor<T>): TypedPropertyDescriptor<T>;\nfunction bindDecorator<T extends Constructor<object>>(target: T): T;\nfunction bindDecorator(target: any, key?: any, descriptor?: any): any {\n    if (!key || !descriptor) {\n        return bindClassDecorator(target);\n    }\n\n    return bindMethodDecorator(target, key, descriptor);\n}\n\nexport default bindDecorator;\n\n/**\n * Decorates a class by binding all its prototype methods to the calling\n * instance.\n */\nexport function bindClassDecorator<T extends Constructor<object>>(target: T): T {\n    const decoratedTarget = class extends target {};\n\n    Object.getOwnPropertyNames(target.prototype)\n        .forEach(key => {\n            const descriptor = Object.getOwnPropertyDescriptor(target.prototype, key);\n\n            if (!descriptor || key === 'constructor') {\n                return;\n            }\n\n            Object.defineProperty(\n                decoratedTarget.prototype,\n                key,\n                bindMethodDecorator(target.prototype, key, descriptor)\n            );\n        });\n\n    return decoratedTarget;\n}\n\n/**\n * Decorates a method by binding it to the calling instance.\n */\nexport function bindMethodDecorator<T extends Method>(_: object, key: string, descriptor: TypedPropertyDescriptor<T>): TypedPropertyDescriptor<T> {\n    if (typeof descriptor.value !== 'function') {\n        return descriptor;\n    }\n\n    let method: T = descriptor.value;\n\n    return {\n        get() {\n            const boundMethod = method.bind(this) as T;\n\n            Object.defineProperty(this, key, {\n                ...descriptor,\n                value: boundMethod,\n            });\n\n            return boundMethod;\n        },\n        set(value) {\n            method = value;\n        },\n    };\n}\n\nexport type Constructor<T> = new (...args: any[]) => T;\nexport type Method = (...args: any[]) => any;\n","import { mapToInternalAddress } from '../address';\nimport { BillingAddress } from '../billing';\n\nimport { Customer } from '.';\nimport InternalCustomer from './internal-customer';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalCustomer(customer: Customer, billingAddress: BillingAddress): InternalCustomer {\n    const firstName = customer.firstName || billingAddress.firstName || '';\n    const lastName = customer.lastName || billingAddress.lastName || '';\n\n    return {\n        addresses: (customer.addresses || []).map(address => mapToInternalAddress(address)),\n        customerId: customer.id,\n        isGuest: customer.isGuest,\n        storeCredit: customer.storeCredit,\n        email: customer.email || billingAddress.email || '',\n        firstName,\n        lastName,\n        name: customer.fullName || [firstName, lastName].join(' '),\n        customerGroupName: customer.customerGroup && customer.customerGroup.name,\n    };\n}\n","import { filter, find, keyBy, reduce } from 'lodash';\n\nimport { mapToInternalLineItems, LineItem } from '../cart';\nimport { Checkout } from '../checkout';\nimport { AmountTransformer } from '../common/utility';\nimport { mapToInternalCoupon } from '../coupon';\nimport { HOSTED } from '../payment';\n\nimport InternalOrder, { InternalGiftCertificateList, InternalIncompleteOrder, InternalOrderPayment, InternalSocialDataList } from './internal-order';\nimport Order, { GatewayOrderPayment, GiftCertificateOrderPayment, OrderPayment, OrderPayments } from './order';\nimport { OrderMetaState } from './order-state';\n\n/**\n * @deprecated This mapper is only for internal use only. It is required during\n * the transition period as we are moving to adopt the new storefront API object\n * schema.\n */\nexport default function mapToInternalOrder(order: Order, orderMeta: OrderMetaState = {}): InternalOrder {\n    const decimalPlaces = order.currency.decimalPlaces;\n    const amountTransformer = new AmountTransformer(decimalPlaces);\n\n    return {\n        id: order.orderId,\n        items: mapToInternalLineItems(order.lineItems, order.currency.decimalPlaces, 'productId'),\n        orderId: order.orderId,\n        currency: order.currency.code,\n        customerCanBeCreated: order.customerCanBeCreated,\n        payment: mapToInternalOrderPayment(order.payments, orderMeta.payment),\n        subtotal: {\n            amount: order.baseAmount,\n            integerAmount: amountTransformer.toInteger(order.baseAmount),\n        },\n        coupon: {\n            discountedAmount: reduce(order.coupons, (sum, coupon) => {\n                return sum + coupon.discountedAmount;\n            }, 0),\n            coupons: order.coupons.map(mapToInternalCoupon),\n        },\n        discount: {\n            amount: order.discountAmount,\n            integerAmount: amountTransformer.toInteger(order.discountAmount),\n        },\n        token: orderMeta.orderToken,\n        callbackUrl: orderMeta.callbackUrl,\n        discountNotifications: [],\n        giftCertificate: mapToGiftCertificates(order.payments),\n        socialData: mapToInternalSocialDataList(order),\n        status: order.status,\n        hasDigitalItems: order.hasDigitalItems,\n        isDownloadable: order.isDownloadable,\n        isComplete: order.isComplete,\n        shipping: {\n            amount: order.shippingCostTotal,\n            integerAmount: amountTransformer.toInteger(order.shippingCostTotal),\n            amountBeforeDiscount: order.shippingCostBeforeDiscount,\n            integerAmountBeforeDiscount: amountTransformer.toInteger(order.shippingCostBeforeDiscount),\n        },\n        storeCredit: {\n            amount: mapToStoreCredit(order.payments),\n        },\n        taxes: order.taxes,\n        taxTotal: {\n            amount: order.taxTotal,\n            integerAmount: amountTransformer.toInteger(order.taxTotal),\n        },\n        handling: {\n            amount: order.handlingCostTotal,\n            integerAmount: amountTransformer.toInteger(order.handlingCostTotal),\n        },\n        grandTotal: {\n            amount: order.orderAmount,\n            integerAmount: order.orderAmountAsInteger,\n        },\n    };\n}\n\nexport function mapToInternalIncompleteOrder(checkout: Checkout): InternalIncompleteOrder {\n    const payment = find(checkout.payments, { providerType: HOSTED });\n\n    return {\n        orderId: null,\n        isComplete: false,\n        payment: !payment ? {} : {\n            id: payment.providerId,\n            gateway: payment.gatewayId,\n            status: mapToInternalPaymentStatus(payment.detail.step),\n        },\n    };\n}\n\nfunction mapToInternalPaymentStatus(status: string): string {\n    return `PAYMENT_STATUS_${status}`;\n}\n\nfunction mapToStoreCredit(payments?: OrderPayments): number {\n    const item = find(payments, { providerId: 'storecredit' });\n\n    return item ? item.amount : 0;\n}\n\nfunction mapToGiftCertificates(payments?: OrderPayments): InternalGiftCertificateList {\n    const items = filter(payments, { providerId: 'giftcertificate' }) as GiftCertificateOrderPayment[];\n\n    return {\n        totalDiscountedAmount: reduce(items, (sum, item) => item.amount + sum, 0),\n        appliedGiftCertificates: keyBy(items.map(item => ({\n            code: item.detail.code,\n            discountedAmount: item.amount,\n            remainingBalance: item.detail.remaining,\n            giftCertificate: {\n                balance: item.amount + item.detail.remaining,\n                code: item.detail.code,\n                purchaseDate: '',\n            },\n        })), 'code'),\n    };\n}\n\nfunction mapToInternalOrderPayment(payments?: OrderPayments, payment: InternalOrderPayment = {}): InternalOrderPayment {\n    const item = find(payments, isDefaultOrderPayment) as GatewayOrderPayment;\n\n    if (!item) {\n        return {};\n    }\n\n    return {\n        id: item.providerId,\n        status: mapToInternalPaymentStatus(item.detail.step),\n        helpText: item.detail.instructions,\n        returnUrl: payment.returnUrl,\n    };\n}\n\nfunction isDefaultOrderPayment(payment: OrderPayment): payment is GatewayOrderPayment {\n    return payment.providerId !== 'giftcertificate' && payment.providerId !== 'storecredit';\n}\n\nfunction mapToInternalSocialDataList(order: Order): { [itemId: string]: InternalSocialDataList } | undefined {\n    const socialDataObject: { [itemId: string]: InternalSocialDataList } = {};\n    const items = [\n        ...order.lineItems.physicalItems,\n        ...order.lineItems.digitalItems,\n    ];\n\n    items.forEach(item => {\n        socialDataObject[item.id] = mapToInternalSocialData(item);\n    });\n\n    return socialDataObject;\n}\n\nfunction mapToInternalSocialData(lineItem: LineItem): InternalSocialDataList {\n    const codes = ['fb', 'tw', 'gp'];\n\n    return codes.reduce((socialData, code) => {\n        const item = lineItem.socialMedia && find(lineItem.socialMedia, item => item.code === code);\n\n        if (!item) {\n            return socialData;\n        }\n\n        socialData[code] = {\n            name: lineItem.name,\n            description: lineItem.name,\n            image: lineItem.imageUrl,\n            url: item.link,\n            shareText: item.text,\n            sharingLink: item.link,\n            channelName: item.channel,\n            channelCode: item.code,\n        };\n\n        return socialData;\n    }, {} as InternalSocialDataList);\n}\n"],"sourceRoot":""}